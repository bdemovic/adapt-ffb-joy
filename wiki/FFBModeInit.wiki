#summary Initialization procedure of FFB mode for FFP's
#labels Featured

= Introduction =

An AVR based tester connected to real game port's X1-line (in 3DPVert this would go to pin B4 on Tweeny 2.0) prints the below interrupt sequences at enumeration and startup of an FFB application. The X1-line is connected to tester's D0 (to get interrupts on changes) with a serial 330k resistor. Using no resistor produced quite erratic results probably due the AVRs interference in the process.

The tester can clock up to 4us accuracy but additional distortion is always possible since it is based on Arduino code, which doesn't give you all the control easily.

The tester prints out time differences between changes in pin value in micro seconds and the value the pin changed to. Results are quite consistent.

Looking at the tester report, there seems to be a pattern where a "command" is a varying number of about 2,5kHz pulses and each "command" is separated by a pause of varying amount of milliseconds. If each "command" could be identified with a number of pulses in it, the startup sequence looks like this:

{{{
1 pulse
    (wait 7 ms)
4 pulses
    (wait 24-41 ms)
3 pulses
    (wait 15 ms)
2 pulses
    (wait 78 ms)
2 pulses
    (wait 4 ms)
3 pulses
    (wait 59 ms)
2 pulses
}}}

I.e. omitting the timings, the command sequence would be "1-4-3-2-2-3-2".

I don't know how exact the timings between the commands have to be or how the timing coincides with other signalling (joystick reports via the button lines, MIDI line or the X2-line interrupts).

Some interrupts are still sent in X1-line after and along the very first MIDI commands. But after the startup sequence is completed, issuing effects data happens on the MIDI-line alone.

The first MIDI commands "0xC5 0x01" are sent around the time after the first "commands" ("1-4-3") have been sent.

The joystick also seems to somehow acknowledge the switch to the PC since if there is a problem in a sequence, Windows will notify that it cannot find a force feedback device and the above commands are not carried thru, but end only as e.g. sequence "1-4-3-2".